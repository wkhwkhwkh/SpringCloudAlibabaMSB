<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.utan.mapper.OrdersMapperCustom">
    <cache type="org.mybatis.caches.ehcache.EhcacheCache"/>
    <resultMap id="ordersMap" type="orders">
        <id column="id" property="id"/>
        <result column="userid" property="userid"/>
        <result column="orderid" property="orderid"/>
        <result column="createtime" property="createTime"/>
        <result column="note" property="note"/>
        <!--配置关联映射单个对象的信息-->
        <association property="person" javaType="com.utan.pojo.User">
            <!--column:指定唯一标识的列
                javaType:映射到user的哪个属性-->
            <id column="userid" property="id"/>
            <result column="userName" property="userName"/>
            <result column="sex" property="sex"/>
            <result column="address" property="address"/>
        </association>
    </resultMap>

    <!--使用extends继承-->
    <resultMap id="ordersMap2" type="orders" extends="ordersMap">
        <collection property="orderDetails" ofType="com.utan.pojo.OrderDetail">
            <id column="orderdetail_id" property="id"></id>
            <result column="orderdetail_orderid" property="orderId"></result>
            <result column="orderdetail_itemnum" property="itemnum"></result>
            <result column="orderdetail_itemid" property="itemsid"></result>
        </collection>
    </resultMap>


    <resultMap id="userAndItemResultMap" type="com.utan.pojo.User">
        <id column="userid" property="id"></id>
        <result column="userName" property="userName"></result>
        <result column="sex" property="sex"></result>
        <result column="address" property="address"></result>

        <collection property="orderList" ofType="com.utan.pojo.Orders">
            <id column="id" property="id"></id>
            <result column="userid" property="userid"/>
            <result column="orderid" property="orderid"/>
            <result column="createtime" property="createTime"/>
            <result column="note" property="note"/>

            <collection property="orderDetails" ofType="com.utan.pojo.OrderDetail">
                <id column="orderdetail_id" property="id"></id>
                <result column="orderdetail_orderid" property="orderId"></result>
                <result column="orderdetail_itemnum" property="itemnum"></result>
                <result column="orderdetail_itemid" property="itemsid"></result>

                <association property="item" javaType="com.utan.pojo.Items">
                    <id column="item_id" property="id"></id>
                    <result column="item_name" property="name"></result>
                    <result column="item_price" property="price"></result>
                </association>
            </collection>
        </collection>
    </resultMap>

    <!--resultType  一对一-->
    <select id="queryOrderByUserId" parameterType="int" resultType="orderCustom" useCache="true">
        select orders.id id,orders.userid userid,orders.orderid orderid,orders.createtime createTime,orders.note note,t_user.userName
             ,t_user.sex,t_user.address from orders,t_user where t_user.id = orders.userid and t_user.id = #{userId}
    </select>

    <!--resultMap 一对一-->
    <select id="queryOrderByUserId2" parameterType="int" resultMap="ordersMap">
        select orders.*,t_user.userName
             ,t_user.sex,t_user.address from orders,t_user where t_user.id = orders.userid and t_user.id = #{userId}
    </select>

    <!--一对多-->
    <select id="queryOrderAndOrderdetailId2" parameterType="int" resultMap="ordersMap2">
        select orders.*,t_user.userName
             ,t_user.sex,t_user.address,orderdetail.id orderdetail_id,orderdetail.orderid orderdetail_orderid,orderdetail.itemid orderdetail_itemid,orderdetail.itemunm orderdetail_itemnum from orders,t_user,orderdetail where t_user.id = orders.userid and orders.id = orderdetail.orderid  and t_user.id = #{id}
    </select>

    <!--多对多-->
    <select id="queryUserAndItemResultMap" parameterType="int" resultMap="userAndItemResultMap">
        select orders.*,t_user.userName-
             ,t_user.sex,t_user.address from orders,t_user where t_user.id = orders.userid and t_user.id = #{userId}
    </select>
</mapper>
